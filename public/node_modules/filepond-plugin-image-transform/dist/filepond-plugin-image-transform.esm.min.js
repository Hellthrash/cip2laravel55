/*
 * FilePondPluginImageTransform 2.0.1
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
const isImage=t=>/^image/.test(t.type),transforms={1:()=>[1,0,0,1,0,0],2:t=>[-1,0,0,1,t,0],3:(t,e)=>[-1,0,0,-1,t,e],4:(t,e)=>[1,0,0,-1,0,e],5:()=>[0,1,1,0,0,0],6:(t,e)=>[0,1,-1,0,e,0],7:(t,e)=>[0,-1,-1,0,e,t],8:t=>[0,-1,1,0,0,t]},fixImageOrientation=(t,e,a,n)=>{-1!==n&&t.transform(...transforms[n](e,a))},imageToImageData=(t,e,a)=>{e||(e={x:0,y:0,width:1,height:1});const n=document.createElement("canvas"),i=t.naturalWidth,o=t.naturalHeight;a>=5&&a<=8?(n.width=o,n.height=i):(n.width=i,n.height=o);const r=n.getContext("2d");r.save(),fixImageOrientation(r,i,o,a),r.drawImage(t,0,0,i,o),r.restore();return r.getImageData(Math.round(e.x*n.width),Math.round(e.y*n.height),Math.round(e.width*n.width),Math.round(e.height*n.height))},imageDataToBlob=(t,e)=>new Promise((a,n)=>{const i=document.createElement("canvas");i.width=t.width,i.height=t.height;i.getContext("2d").putImageData(t,0,0),i.toBlob(a,e.type,e.quality)}),objectToImageData=t=>{let e;try{e=new ImageData(t.width,t.height)}catch(a){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},TransformWorker=()=>{const t={resize:function(t,e){const{mode:a,upscale:n}=e;let{width:i,height:o}=e.size;if(null===i?i=o:null===o&&(o=i),"force"!==a){let e=i/t.width,r=o/t.height,s=1;if("cover"===a?s=Math.max(e,r):"contain"===a&&(s=Math.min(e,r)),s>1&&!1===n)return t;i=t.width*s,o=t.height*s}const r=t.width,s=t.height,g=Math.round(i),h=Math.round(o);for(var l=t.data,d=new Uint8ClampedArray(g*h*4),m=r/g,c=s/h,u=Math.ceil(m/2),p=Math.ceil(c/2),f=0;f<h;f++)for(var w=0;w<g;w++){for(var T=4*(w+f*g),v=0,y=0,M=0,x=gx_g=gx_b=gx_a=0,b=(f+.5)*c,I=Math.floor(f*c);I<(f+1)*c;I++)for(var _=Math.abs(b-(I+.5))/p,E=(w+.5)*m,A=_*_,O=Math.floor(w*m);O<(w+1)*m;O++){var R=Math.abs(E-(O+.5))/u,$=Math.sqrt(A+R*R);$>=-1&&$<=1&&(v=2*$*$*$-3*$*$+1)>0&&(R=4*(O+I*r),gx_a+=v*l[R+3],M+=v,l[R+3]<255&&(v=v*l[R+3]/250),x+=v*l[R],gx_g+=v*l[R+1],gx_b+=v*l[R+2],y+=v)}d[T]=x/y,d[T+1]=gx_g/y,d[T+2]=gx_b/y,d[T+3]=gx_a/M}return{data:d,width:g,height:h}}};self.onmessage=(e=>{((e,a)=>{a(((e,a)=>(e.forEach(e=>{a=t[e.type](a,e.data)}),a))(e.transforms,e.imageData))})(e.data.message,t=>{self.postMessage({id:e.data.id,message:t},[t.data.buffer])})})};HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,a){const n=this;setTimeout(()=>{const i=n.toDataURL(e,a).split(",")[1],o=atob(i);let r=o.length;const s=new Uint8Array(r);for(;r--;)s[r]=o.charCodeAt(r);t(new Blob([s],{type:e||"image/png"}))})}});var plugin$1=t=>{const{addFilter:e,utils:a}=t,{Type:n,forin:i,loadImage:o,getFileFromBlob:r,getFilenameWithoutExtension:s,createWorker:g,createBlob:h,renameFile:l,isFile:d}=a,m=["resize"];return e("PREPARE_OUTPUT",(t,{query:e,item:a})=>new Promise((n,c)=>{if(!d(t)||!isImage(t)||!e("GET_ALLOW_IMAGE_TRANSFORM"))return n(t);const u=e("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),p=null===u?null:u/100,f=e("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),{crop:w}=a.getMetadata(),T=[];if(i(a.getMetadata(),(t,e)=>{m.includes(t)&&T.push({type:t,data:e})}),null===p&&null===f&&!w&&!T.length)return n(t);const v=(e,a)=>{imageDataToBlob(e,a).then(e=>{const a=r(e,((t,e)=>{return`${s(t)}.${"image/jpeg"===e?"jpg":e.split("/")[1]}`})(t.name,(t=>"image/jpeg"===t||"image/png"===t?t:"image/jpeg")(e.type)));n(a)}).catch(t=>{console.error(t)})},y=URL.createObjectURL(t);if(/svg/.test(t.type)&&null===f){if(!w)return n(t);const e=new FileReader;return e.onloadend=(()=>{const a=document.createElement("div");a.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",a.innerHTML=e.result;const i=a.querySelector("svg");document.body.appendChild(a);const o=i.getBBox();a.parentNode.removeChild(a);const r=i.getAttribute("viewBox")||"",s=i.getAttribute("width")||"",g=i.getAttribute("height")||"";let d=parseFloat(s)||null,m=parseFloat(g)||null;const c=(s.match(/[a-z]+/)||[])[0]||"",u=(g.match(/[a-z]+/)||[])[0]||"";i.removeAttribute("width"),i.removeAttribute("height");const p=i.outerHTML,f=r.split(" ").map(parseFloat),T=f.length?{x:f[0],y:f[1],width:f[2],height:f[3]}:o;d||(d=T.width),m||(m=T.height);const v=`width="${d*w.rect.width}${c}"`,y=`height="${m*w.rect.height}${u}"`,M={x:d*-w.rect.x,y:m*-w.rect.y};n(l(h(`<?xml version="1.0" encoding="UTF-8"?>\n<svg ${v} ${y} \n  viewBox="0 0 ${d} ${m}" \n  preserveAspectRatio="xMinYMin slice"\n  xmlns="http://www.w3.org/2000/svg">\n  <g transform="translate(${M.x}, ${M.y})">\n    ${p}\n  </g>\n</svg>`,"image/svg+xml"),t.name))}),void e.readAsText(t)}o(y).then(e=>{URL.revokeObjectURL(y);const n=(a.getMetadata("exif")||{}).orientation||-1,i=imageToImageData(e,w?w.rect:null,n);if(!T.length)return void v(i,{quality:p,type:f||t.type});const o=g(TransformWorker);o.post({transforms:T,imageData:i},e=>{v(objectToImageData(e),{quality:p,type:f||t.type}),o.terminate()},[i.data.buffer])})})),{options:{allowImageTransform:[!0,n.BOOLEAN],imageTransformOutputMimeType:[null,n.STRING],imageTransformOutputQuality:[null,n.INT]}}};"undefined"!=typeof navigator&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin$1}));export default plugin$1;